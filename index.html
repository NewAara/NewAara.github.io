
<!doctype html><html><head id="head"><meta charset="utf-8"><style>html,body{margin:0;} .content{display:none}</style></head><body id="root">
<div id="gardens_and_skyscrapers" class="content">`webtitle[aara]


`top[
`title[A Synopsis]
`massive fancy center div[of]
`title[Two Cities]
]


`page div[
`line[]
`header[`big[1)] Gardens]

There's a stream that's been diverted into little waterfalls, bordered on each side by flowers and trees. Rivulets trickle into a garden lush with grapefruits, pumpkins, melons.

In a clearing, an ornate stone table sits with plates of food. There are almost always chefs preparing something in the community kitchen nearby, and they leave the abundance on the table for people walking in the gardens.

There are workshops scattered among the trees, built of wood in imitation of natural elegance, the stained glass windows reflecting the colors of the leaves in Fall.

After walking hand in hand with a dear friend you part ways and turn home. As you walk, you pass by a shepard tending their heifers, a number of grottos built into the earth itself.

As you pass a cellar you haven't been in before, you feel yourself invited, the fabric of your clothing cascading on your skin in gentle waves towards the door. You accept the invitation. It's a small yet extravagant chamber with an ancient aesthetic, the wall mountings like mythical relics. It's lit by a fireplace and rays of light from above. Three beautiful people are sitting, conversing. They invite you to have a drink with them. One gets up and walks you to the counter.

She explains as she pours a metal goblet: 'It's a citrus cocktail with a floral extract. Your mind might feel a bit softer, but the general effect is exhilarating. My friend's been breeding these flowers for decades. I assume it's good for you or else you wouldn't be here.' She says it with a smile. The mesh on your wrists continues to roll in calm waves, assuring you it's good. You spend some hours there before continuing home.

There's a small city in the distance. You see its lights glowing in the dusk, and near that you recognize the gothic college where you learned to weave the computational fabrics that dance on your arms like guiding winds.

Your home is in a small vale. Your neighbor lives a couple acres over; she has a workshop where she makes clothing of the fabrics you weave.

You're safe. There's wealth all around you. Those who want to live forever elect to get a few surgeries when they reach adulthood; those who don't usually marry and make babies. There's harmony. There are children playing outside your home, and there's land on Earth for each of them.
`br[40]
`line[]
`header[`big[2)] Skyscrapers]

Light reflects from glass, solar panels, metal. Roads are enmeshed between buildings in layer upon layer, with channels for air traffic and public transport systems between them.

Apartments, corporate offices, stores, microfarms, garages, schools, are intermixed block to block, level to level.

Getting to work is a matter of riding to the station in a self-driving taxi (pay more for one without ads), getting into public transport pods where you see a stream of ads on the video screen. You're offered discounts and bonuses for buying things. You can do it right there. You can buy things right there. It'll be waiting for you at home.

The indoor pavilion's crowded with foot traffic. As you enter your office building, the roar of drones and traffic is suddenly dampened.

You get to work. It's analysis, meetings, emails, presentations. You're managing mining teams on Mars. The teams around you are managing space travel.

It's frustrating, because the team you're working with is using version 24-a0.45, and you're on version 23-b1.44.

The city spills into the bay, underwater domes connected by tunnels, a giant lattice-work, a single connected building. You have a meeting 20,000 feet underwater with scientists developing new high-pressure mining techniques. It takes 35 minutes to get there, your company hyper-shuttle lets you work on the way. It stops at a Starbucks for a 7-minute coffee break.

It's a lounge with plush leather chairs and ambient lighting that cycles through colors. The hostess greets your company. 'Welcome to Starbucks, let me know if there's anything I can do to make your stay perfect. Just a reminder that sugary drinks like our Mocha Carmel Blacktea Frappuccino can increase the risk of diabetic conditions. We offer complementary Sweetease to offset this risk by as much as 78%. Just remember that it's best to consult your doctor before taking any supplement.' It's all said with a smile. A couple coworkers' eyes glaze over as they read up on Sweetease on the Internet. As she's handing everyone their pre-ordered drinks, you feel a sudden buzz in your wrist informing you that you just paid. You get a notification that you just earned points towards your next drink.

You're nervous talking to the scientists because you remember seeing an accident on the news, a tube broke and people were crushed under electrically acidified salt-water. It's rare, but it's happened more than once at this depth. A lot of teams are working to analyze why accidents like that happen, how to engineer safer structures.

You're one in 29 billion people and counting. They'll pay your closest relatives your expected salary over the next 5 years.

Everyone has implants. The rich are more cybernetic than human. They can live forever but people sometimes wonder if they're even alive anymore. Everyone else lives until their debt gets too high, and then you have to go outside and you die pretty quickly after that. It's not good to breathe the air.

If you want to live, you need a corporate job. Everyone pays with implanted chips, and you can't get money except through a job. Some people get rich as artists, but once they say or do the wrong thing they stop trending and they usually end up outside.

You don't really know what you're working towards, but you're afraid to say that. If you say that you'll be fired. They want passionate, motivated individuals, not directionless narcissists who are just doing it for the money.

You get home. The new thing you ordered is there. It's okay.



`gray header[Reflections]
`line[]

`size[20|These are both potential futures for the year 2200.]

It's odd, that although so many would prefer the gardens, and although these natural settings would require far less work and fewer resources to bring about, the skyscrapers feel like a more "realistic" description of the future. The gardens feel like fantasy. Why?

There's demand for the gardens, but the market never hears it. We're raised in urban settings, and by the time we're educated, we're in tens of thousands of dollars of debt; we need jobs. Almost all of the jobs that can pay off debt are in urban settings, so we live in urban settings, and in turn, buy that which supports city life. The market hears demand for city life, so it optmizes the production of city life.

Today, there are farms where we're surrounded by nature, and there are cities where everything we need is nearby, but it's almost impossible to find communities where there's a happy medium--where homes and workshops are placed just right--so that buildings are surrounded by open spaces, yet no matter where we are, there are places to work and ways to meet our needs within walking distance.

The gardens are the height of economic efficiency, where even the work environment is healthy and beautiful. It means journeys instead of commutes, communal feasts instead of restaurants, environments where we can flow instead of manage, where the waste cleans itself.

The tragedy of our modern way of life is that it's a closed loop, a self-affirming cycle. In order to live in the modern world, we have to go into noisy stores, sit in traffic, buy products in wasteful packaging--even if that isn't what we truly want, even if what we truly desire is a quiet open space, lasting community, never having to tear open cardboard packaging or plastic wrapping. We end up buying things to cope with modernity, with stress, with debt, and in turn, the market keeps demanding we produce more and more of what we don't truly want. 

There's a logic driving the expansion of concrete cities, that the fastest way to monetize a space is to build shops or living spaces as densely together as possible, in tight grids, row after row. But this isn't truly the most efficient use of land. Everyone has to `i[see] that. 

To achieve the gardens, we need to start planning cities around `i[people], not profits. We need to imagine the city from the eyes of a single person, and to design spaces so that every moment in the process of meeting their needs is beautiful. It's a model of efficiency grounded in actual experience rather than statistical calculation.

Today, we are closer to the gardens but we are accelerating in the direction of the skyscrapers. Realistically, the gardens would take less work and suffering to create, but it's harder to justify working on them in the rush of the modern system. We urgently need to slow down, quickly.

We can either embrace simplicity, pursue the natural bliss of the gardens, or we can continue to build grander and grander mazes defined by deadlines.

Achieving the gardens is a matter of having an economic system in which our actual desires can be expressed and acted upon, where our lives are governed by `i[need] instead of bureaucratically registered measurements of growth and profit.

A truly elegant society is one that supports us in any work that meets a real need, not just those that are bureaucratically recorded. When we can easily account for ourselves and coordinate action directly around expressed needs, we will find freedom to pursue our highest good. 

Let's look towards the day when we can earn our food, our home, and our luxury doing work in the garden.

`br[40]
`line[#ccc]
`note[if you'd also like a home in the gardens, email `b[me at aara.us]--I'm a writer, painter, and programmer looking for friends and partners]
]

`fonts[Lustria,Raleway,Quicksand,Stalemate,EB Garamond]
`css[
	body,html{margin:0;padding:0;font:13px Lustria; line-height:20px;}
	a{color:#ff2934; text-decoration:none;transition:color 1s;}
	a:hover{color:#b44;}
	.top{width:300px;margin:50px auto;}
	.title{font:44px EB Garamond; text-align:center;}
	.header{font-family: EB Garamond; font-size:26px;}
	.cross{text-decoration:line-through;}
	.span{display:inline;}
	.big{font-size:1.6em;position:relative;top:4px;}
	.massive{font-size:3.4em;}
	.fancy{font-family:Stalemate;}
	.center{text-align:center;}
	.gray{color:#666;}
	.line{border:1px solid #666;}
	.abstract{text-decoration:italics;margin-top: 20px; font-size:15px; font-family: EB Garamond;}
	.note{font-size:11px;}
	.page{width: 450px; margin:0 auto;}
	.footer{width: 500px; margin:30px auto; padding: 20px;}
	.error{color:#900;font-weight:bold; padding: 20px; font-size:1.3em;}
] 
</div><script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script></body><script>var
_ = {
    // iterate over all properties in an object
    e: function(obj, func) {
      if(!obj) return ;
      if(typeof obj.e === "function") obj.e(func);
      else {
        var fields = Object.entries(obj);
        for(var i = 0, l = fields.length; i<l; i++) {
          var o = fields[i];
          func(o[1], o[0]);
        }       
      }
    },
    // copies over everything in 'options' 
    // to the 'standard' object,
    // pass in opts{copy:true} to make it so that
    // the standard itself is not changed,
    // good for assigning default values using:
    // _.x(defaults, options);
    x: function(standard, options, opts) {
      var result = (opts&&opts.copy) ? {} : standard;
      for(prop in options) {
        if(opts && opts.deep && typeof standard[prop] === "object") {
          _.x(result[prop], options[prop]);
        } else {
         result[prop] = options[prop];
        }
      }
      return  result;
    },
    // shorthand for var = obj[prop]?obj[prop]:another[prop];
    w: function(prop, preferred, fallback) {
      return  preferred[prop]?preferred[prop]:fallback[prop];
    },
    clone: function(obj, opt) {
      var o = _.x({shallow:false,just:null},opt), 
        result = Array.isArray(obj) ? [] : {};
      _.e(obj, function(value, field) {
        if(o.just && !o.just[field]) return ;
        if(typeof value === "object") {
          result[field] = o.shallow ? value : _.clone(value);
        } else {
          result[field] = value;
        }
      });
      return  result;
    },
    map: function(list, func) {
      var results = Array.isArray(list)?[]:{};
      _.e(list, function(v,i) {
         results[i]=func(v,i);
      });
      return  results;
    },
    csv: function(text) { return  text.split(',') },
    comp: function(obj, values) {
      var diff = false;
      _.e(values, function(val, prop) {
        if(obj[prop] !== val) diff = true;
      });
      return  !diff;
    },
    same: function(obj1, obj2) {
      return  _.comp(obj1,obj2) && _.comp(obj2,obj1);
    },
    filter: function(list, func) {
      var filtered = Array.isArray(list)?[]:{};
      _.e(list, function(item) {
        if(func(item)) filtered.push(item);
      });
      return  filtered;
    },
    contains: function(list, item) {
      for(var i = 0, l = list.length; i < l; i++) {
        if(list[i] === item) {
          return  true;
        }
      }
      return  false;
    },
    async: function(list, handler, cb) {
      var count = list.length,
          results = [],
          then = function(i, result) {
            results[i] = result;
            if(--count <= 0) {
              cb(results);
            }
          };
      list.forEach(function(item, i) {
        handler(item, then.bind(list, i));
      });
    },
    save_js: function(obj) {
      var str = '{', type, val;
      _.each(obj, function(field, name) {
        type = typeof field;
        if(type === "object") {
          val = _.save_js(field);
        } else
        if(type === "F") {
          val = field.toString();
        } else {
          val = field;
        }
        str += field+':'+val+',';
      });
      return  str + '}';
    },
},
C = function(init, methods) {
    _.x(init.prototype, methods);
    return  init;
},
eventypes = [
  "click","dblclick",
  "mousedown","mouseup","mousemove","mouseover","mouseleave",
  "dragstart","dragover","drop","copy","paste",
  "keyup", "keydown","keypress",
  "focus","blur","change","scroll","select","selectstart",
],
keycodes = {
  '⌫': 8, backspace: 8,
  '⇥': 9, '⇆': 9, tab: 9,
  '↩': 13, 'return': 13, enter: 13, '⌅': 13,
  'pause': 19, 'pause-break': 19,
  '⇪': 20, caps: 20, 'caps-lock': 20,
  '⎋': 27, escape: 27, esc: 27,
  space: 32,
  '↖': 33, pgup: 33, 'page-up': 33,
  '↘': 34, pgdown: 34, 'page-down': 34,
  '⇟': 35, end: 35,
  '⇞': 36, home: 36,
  ins: 45, insert: 45,
  del: 46, 'delete': 46,
  '←': 37, left: 37, 'arrow-left': 37,
  '↑': 38, up: 38, 'arrow-up': 38,
  '→': 39, right: 39, 'arrow-right': 39,
  '↓': 40, down: 40, 'arrow-down': 40,
  '*': 106, star: 106, asterisk: 106, multiply: 106,
  '+': 107, 'plus': 107,
  '-': 109, subtract: 109,
  ';': 186, semicolon:186,
  '=': 187, 'equals': 187,
  ',': 188, comma: 188,
  '.': 190, period: 190, 'full-stop': 190,
  '/': 191, slash: 191, 'forward-slash': 191,
  '#': 192, tick: 192, 'back-quote': 192,
  '[': 219, 'open-bracket': 219,
  '\\': 220, 'back-slash': 220,
  ']': 221, 'close-bracket': 221,
  '\'': 222, quote: 222, apostraphe: 222,
},
i = 95, n = 0;
while(++i < 106) {
    keycodes['num-' + n] = i;
    ++n;
}
i = 47, n = 0;
while(++i < 58) {
    keycodes[n] = i;
    ++n;
}
i = 111, n = 1;
while(++i < 136) {
    keycodes['f' + n] = i;
    ++n;
}
i = 64;
while(++i < 91) {
    keycodes[String.fromCharCode(i).toLowerCase()] = i;
}
var get = {
  letter: function(e) { var k = e.keyCode; return  64<=k&&k<91 ? 
    keycodes[k] : null;
  }
},
El = C(function(html, opts) {
  // class for working with html el(emnts)

  //html can be either a tag type (like "div","span", etc)
  //or an #id selector, in which case it will use the 
  // existing el with that id if it exists, or
  // create a new el with that id
  var T = this;
  T.el = (typeof html === "string" || !html) ? 
      (html && html[0] === '#') ? 
          document.getElementById(html.substring(1)) :
          document.createElement(html ? html : "div")
      : (html instanceof El) ? html.el : html;
  T.set(opts);
},{
  set: function(opts) { var T = this;
    _.e(opts, function(val, opt) {
      if(typeof T[opt] === "function") T[opt](val);
    });
  },
  attr: function(attrs) { var T = this;
    _.e(attrs, function(a, name) {
      T.el.setAttribute(name, a);
    });
  },
  id: function(name) {
    var T = this; T.attr({id:name});
  },
  editable: function(bool) { var T = this;
    T.attr({contenteditable:bool?"true":false});
  },
  into: function(el, before) {
    var tel = new El(el);
    tel.insert(this.el, before);
    return  tel;
  },
  remove: function(el) {
    var T = this, e = new El(el);
    T.el.removeChild(e.el);
  },
  html: function(text) {
    var T = this; T.el.innerHTML = text;
  },
  addClass: function(cl) {
    var T = this, classes = T.el.className.split(' ');
    if(!_.contains(classes, cl)) T.el.className +=' '+cl;
  },
  removeClass: function(cl) {
    var T = this, classes = _.filter(T.el.className.split(' '), function(name) {
      return  name !== cl;  
    });
    T.el.className = classes.join(' ');
  },
  toggleClass: function(cl) {
    var T = this, classes = T.el.className.split(' ');
    if(_.contains(classes, cl)) {
      T.removeClass(cl);
    } else {
      T.addClass(cl);            
    }
  },
  placeholder: function(name) {
    var T = this; T.attr({
      name: name,
      contenteditable: "true",
    });
  },
  insert: function(other, before) {
    var T = this,
    other_el = new El(other);
    if(before) {
      var bel = new El(before);
      T.el.insertBefore(other_el.el, bel.el);
    } else {
      T.el.appendChild(other_el.el);
    }
    other_el.up = T;
    return  other_el;
  },
  style: function(styles) {
    _.x(this.el.style, styles);
  },
  getstyle: function(prop) { var T = this;
    return  window.getComputedStyle(T.el, null)
    .getPropertyValue(prop);
  },
  on: function(eventmap) { var T = this, elem = T.el;
    _.e(eventmap, function(handler, trigger) {
      if(_.contains(eventypes, trigger)) {
        elem.addEventListener(trigger, handler.bind(T));
      } else {
        var parts = trigger.split('++'),
        mods = (parts.length>1) ? parts.slice(0,parts.length-1) : [],
        key = parts[parts.length-1];
        elem.addEventListener("keydown",function(e){
          var modded = true, code = e.which?e.which:e.keyCode;
          _.e(mods,function(m){ if(!e[m+"Key"]) modded = false; } );
          if(modded && keycodes[key]===code) {
            handler.call(T,e);
          }
        });
      }
    });
  },
  focus: function() { this.el.focus(); },
  width: function() { return  this.el.offsetWidth; },
  height: function() { return  this.el.offsetHeight; },
  rect: function() { var T = this, r = T.el.getBoundingClientRect(); 
    return  new Rect(r.left, r.top, r.width, r.height);
  },
  top: function() { return  this.rect().top; },
  bottom: function() { return  this.rect().bottom; },
  center: function() { 
    var r = this.rect(); 
    return  [(r.bottom - r.top)/2, (r.right - r.left)/2];
  },  // convenience, reactive styling, assumes 'anim'
}), E = C(function(html,opts) {
  var T = this, styles = {opacity:0};
  if(opts && opts.style) opts.style = _.x(styles, opts.style);
  else opts.style = styles;
  T.el = new El(html,opts);
  T.speeds = {
    opacity: .005,
    height: 0.01,
  };
  T.a = anim.a(styles, function() { 
    var V = this; T.el.style(V);
  });
},{
  trans: function(setting){ var T = this;
    opt =  _.map(setting, function(v,prop) {
      return  T.prepare(prop,v);
    });
    anim.trans(T.a,opt);
  },
  prepare: function(prop,opts) { 
    var T = this; return  _.x({
      speed: T.speeds[prop],
    }, opts);  
  },
  show: function(then) { var T = this;
    T.trans({
      opacity:{to:1,then:then},
      //height:{to:height},
    });
    T.shown = true;
  },
  hide: function(then) { var T = this;
    T.trueheight = T.el.height();
    T.trans({
      opacity:{to:0,then:then},
    });
    T.shown = false;
  },
}),
tag = 	function(name, text, attr) {
		var out = "<"+name;
		if(attr) _.e(attr,function(content,prop) {
			out += ' '+prop+"='"+content+"'";
		})
		return  out+">"+text+"</"+name+">";
	},
styles = {
	i: function(text) { return  tag('i',text) },
	b: function(text) { return  tag('b',text) },
	'^': function(text) { return  tag('sup',text); },
	'v': function(text) { return  tag('sub',text); },
	a: function(text) { 
		var parts = text.split("|")
		return  tag('a',parts[0],{
			href: parts[1],
		});
	},
	br: function(px) { return  tag("div",'',{style:"height:"+px+"px"}); },
	css: function(text) { return  tag("style",text.replace(new RegExp('<br>','g'),'')); },
	js: function(text) { return  eval(text); },
	style: function(text, then) {
		var [name,applyto,content] = text.split('|');
		then(function(text){
			_.e(applyto.split(','), function(toreplace) {
				text.replace(new RegExp(wrap,'g'),
									 tag("span",wrap),{class:name});
			});
		});
	},
//	cite: function(text) { 
//		var i = ++footer.notes,
//				parts = text.split("|"), 
//				note = { into: footer };
//		if(parts.length > 2) {
//			note.html = i+": "+parts[0]+' | '+styles.a(parts.slice(1).join('|'))
//		} else {
//			note.html = i+": "+styles.a(parts.join('|'))
//		}
//		new El("div",note);
//		return  tag("sub",'['+styles.a(i+'|'+parts[parts.length-1])+']');
//	},
	compare: function(text) {
		var columns = text.split(text,'|'),
			  output = '';
		_.e(columns, function(col) {
			var [title,content] = col.split('/');
			output += tag("div",
				tag("div",title,{class:"code-title"}) +
				tag("div",content,{class:"code-column"})
			);
		});
	},
	progress: function(text) {
		var [percentage,style] = text.split('|');
		return  tag("div", 
			tag("span",
					tag("span",'',style),
					{style:'float:left; opacity:.6;'+style}
			) +
			tag("span",percentage+'%',{style:"font-weight: bold;"})
		);
	},
	fonts: function(text) {
		var fonts = text.split(',');
		WebFont.load({
			google: {
				families: fonts,
			}
		})
		return  '';
	},
	title: function(text) {
		return  tag("div",text,{
			class: "title",
			id: text,
		});
	},
	table: function(text) {
		var lines = text.split(/\r\n|\n/),
				out = '';
		_.e(lines, function(line) {out += styles.row(line)});
		return  tag("table",out);
	},
	row: function(text) {
		var cols = text.split('|'),
				out = '';
		_.e(cols, function(col) {out += tag("td",col)});
		return  tag("tr",out);
	},
	list: function(text) {
		var lines = text.split("<br>"),
				out = '', type, isitem;
				console.log(text,lines);
		_.e(lines, function(line) {
			console.log("-",line);
			type = "list-item"; isitem = false;
			if(line.startsWith('O ')) {
				type = "list-header";
				isitem = true;
			}
			if(isitem || line.startsWith('o ')) {
				out += tag("tr",
					tag("td",'',{class:"list-bullet"})+tag("td",line.slice(2)),
					{class:type});
			} else {
				out += styles.row("|"+line);
			}
		});
		return  tag("table",out,{class:"list"});
	},
	fitpage: function(text,then) {
		var el = new El("span",{
			html: text,
		});
		then();
		return  ;
	},
	section: function(text) {
		var parts = text.split('|'),
				title = parts[0],
				id = '#"+title+"-content',
				out = styles.header(title) + tag("div", parts[1]);
				out = tag("div", out, {
					onclick: "show('"+id+"')",
				});
				out += tag("div", parts[2],  {
					id: id,
					style: "display:none;",
				});
				menu.header(title);
		return  out;
	},
	line: function(text) {
		return  tag("div",'',{
			style:"border:1px solid "+(text?text:"#666")
		});
	},
	header: function(text) {
		return  tag("h2",text,{
			class: "header",
		});
	},
	form: function(text, then) {
		var [name, placeholder] = text.split('|');
		el = new El("span",{
			placeholder: placeholder?placeholder:name,
			on: {
				change: function(e) {
					console.log("sending","T.context"+'\n'+name+":"+el.el.innerHTML);
					//T.com(T.context+'\n'name+":"+el.el.innerHTML);
				}
			}
		});
	},
	webtitle: function(text) {
		var el = new El("#title");
		if(!el.el) {
			new El("title", {
				into: "#head",
				html: text,
				id: "title",
			});
		} else {
			el.html(text);
		}
		return  '';
	},
	schedule: function(text, then) {
		var [times, taken] = text.split('|'),
				stamp = Date.now(),
				id = "schedule-"+stamp,
			  el = new El("div", {

			  });
		then(function(){this.el.into("#"+id);},{el:el});
		//then(place("el",id));
		return  tag("schedule",'',{id:id});
	},
	size: function(text) {
		var [size, content] = text.split('|');
		return  tag("span",content,{style:"font-size:"+size+'px;'});
	},
	div: {
		header: true,
		title: true,
		line: true,
	}
},
Order = C(function(i){
	var T = this; T.i = null; T.b = null;
	T.focus = null;
	if(i) T.add(i);
	T.size = 0;
},{
	add: function(i) { var T = this, n=T.i;
		if(!T.i) T.focus = T.i = T.b = {0:i}; else {
			T.focus = T.i = T.i[-1] = {0:i,1:T.i};
		}
		++T.size;
	},
	on: function(i) {
		var T = this, b=T.b; T.focus=T.b={0:i}; T.b[-1]=b;
		if(b) b[1]=T.b;
		if(!T.i) {
			T.focus = T.i = T.b;
		}
		++T.size;
	},
	del: function() {
		var T = this; if(T.size === 0) return ;
		var f = T.focus, t = f[1], a = f[-1];
		if(t) t[-1] = a; else T.b = a;
		if(a) a[ 1] = t; else T.i = t;
		delete f[0];
		T.focus = a?a:t;
		if(!T.focus) { T.i = T.b = null; }
		--T.size;
	},
	place: function(i,af) { var T = this, f = af?af:T.focus;
		if(f) {
			var p = f[1], n = {0:i,1:f[1]}; n[-1]=f;
			f[1] = T.focus = n;
			if(f===T.b) {T.b = n;}
			else p[-1] = n;
			++T.size;
		} else { T.add(i); }
	},
	insert: function(i,b4) { var T = this, f = b4?b4:T.focus;
		if(f) {
			var p = f[-1], n = {0:i,1:f}; n[-1]=f[-1];
			f[-1] = T.focus = n;
			if(f===T.i) {T.i = n}
			else p[1] = n;
			++T.size;
		} else { T.add(i) };
	},
	remove: function(i) {
		var T = this, n=T.i, l;
		if(i) while(n) {
			if(n[0] === i) {
				if(l) { l[1]=n[1]; --T.size; break; }
			}
			l = n;
			n = n[1];
		}
		return  n;
	},
	append: function(order) {var T = this; 
		if(T.b) T.b[1] = order.i;
		else T.i = T.b = T.focus = order.i;
		T.size += order.size;
	},
	shift: function(where) { 
		var T = this, f = T.focus, 
		o = f[typeof where === "number" ? where : T.dict[where]]; 
		T.focus = o?o:f;
	},
	turn: function() {	var T = this; T.shift(1); },
	back: function() { var T = this; T.shift(-1); },
	e: function(f,dir) {var T = this; T.ef(f,T.i,dir); },
	ef: function(f,fi,dir) { var T = this, i=0, n=fi?fi:T.i, d=dir?dir:1;
		while(n) {
			if(f(n[0],i)) return  n;
			n=n[1]; i+=d;
		}
	},
	dict: {
		over: 1, under: -1, top: 0,
		right: 1, left: -1, here: 0,
		down: 1, up: -1,
		after: 1, before: -1, o: 0,
		next: 1, prev: -1, v: 0,
	},
}), 
// responsive order for use with list of elements
Rorder = C(function(root, opts) { var T = this;
	T.order = new Order();
	T.root = root;
	T.map = {};
	
	_.x(T,_.x({
		elopts: {},
		eltype: "div",
		gen: function(text) { return  text },
	}, opts));
},{
	o: function(command, item, opt) { var T = this,
		el = T[command](item, opt);
		T.order[command](item, opt);
		if(Array.isArray(el)) {
			var n = T.order.focus, i = 0;
			while(n) {
				T.map[n] = el[i];
				n = n[1];
				i++;
			}
		} else {
			T.map[T.order.focus] = el;			
		}
	},
	create: function(item) {
		var T = this, el = new El(T.eltype, T.elopts);
		el.html(T.gen(item));
		return  el;
	},
	cascade: function(f, delay, fi, dir) {
		var T = this; T.order.ef(function(item,i) {
			var el = T.map[item];
			setTimeout(f.bind(T,el,item,i),delay*i);
		});
	},
	add: function(i) { var T = this, top = T.map[T.order.i],
		el = T.create(i);
		T.root.insert(el,top);
		return  el;
	},
	on: function(i) { var T = this, el = T.create(i);
		T.root.insert(el);
		return  el;
	},
	del: function() { var T = this, el = T.map[T.order.focus];
		T.root.remove(el);	return  el;	
	},
	place: function(i,af) { var T = this, el = T.create(i),
		before = T.map[af[1][0]];
		T.root.insert(el,before);
		return  el;
	}, // v^ mirrors, merge to one function
	insert: function(i,b4) { var T = this, before = T.map[b4],
		el = T.create(i);
		T.root.insert(el,before);
		return  el;
	},
	append: function(order) {var T = this, els = [];
		order.e(function(i) {
			var el = T.create(i); els.push(el);
			T.root.insert(el);
		}); return  els;
	},
	shift: function(where) { },
	turn: function() {	},
	back: function() { },
	e: function(f,dir) {var T = this; T.ef(f,T.i,dir); },
	ef: function(f,fi,dir) { var T = this, i=0, n=fi?fi:T.order.i, d=dir?dir:1;
		while(n) {
			if(f(T.map[n],n[0],i)) return  n;
			n=n[1]; i+=d;
		}
	},
}),
Editor = C(function(root) { var T = this;
	T.root = new El(root);
	T.queue = [];
	T.editor = new El("div", {
		into: root,
		addClass: "editor",
		on: {
			keypress: function(e) {
				var content = T.editor.el.innerHTML,
				output = T.parse(content.replace('<br>','\n'));
				if(output) {
					T.content = output;
				} else {
					T.editor.addClass("error");
				}
			},
		}
	});
	T.current = null;
	T.title = new El("div", {
		into: T.editor,
		editable: true,
		on: {
			keyup: function(e) {
				T.editor.id(this.innerHTML);
				T.current = this.innerHTML;
			}
		}
	});
	T.content = new El("div", {
		into: T.editor,
		editable: true,
		on: {
			keyup: function(e) {
				T.load(T.current);
			}
		}
	});
	T.content = '';
	T.presentation = new El("div", {into:root});
	T.styles = _.x({
		make: function(text) {
			var [name, f] = text.split('|');
			T.styles[name] = new Function("text","then",f);
		},
	}, styles);
//	T.styles = {
//		make: function(text) {
//			var [name, f] = text.split('|');
//			T.styles[name] = new Function("text","then",f);
//		},
//	};

	T.parsetext = [
			[/--/g,'–'],
			[/\"/g,'\\"'],
			//[/``/g,'"+T.escape("'],
			[/`/g,'"+T.in("'],
			[/\[\s*(\r?\n)?/g,'","'],
			[/\]/g,'")+"'],
			[/\r?\n/g,'<br>'],
			];
	T.parsejs = [
			[/var T = this,/g,"var T = this,"],
			[/var V = this,/g,"var V = this,"],
			[/;/g,";"],
			[/,/g,","],
			[/,\)/g,")"],
			[/Array.prototype.slice.apply(arguments)/g,"Array.prototype.slice.apply(arguments)"],
			[/return /g,"return "],
			[/#\(/g,": function("],
			[/F\(/g,"function("],
			[/args/g,"text.split('|')"],
			];
	T.sdk = _.csv("store");
	T.hidden = _.csv("T,this,document,window");
},{
	load: function(title) { var T = this,
		el = new El("#"+title),
		title = title.replace(/_/g,' '),
		content = T.parse(el.el.innerHTML);
		if(content) {
			_.e(T.queue, function(f) {
				f(content);
			});
			T.editor.removeClass("error");
			T.presentation.html(content);
		} else {
			T.editor.addClass("error");
		}
	},
	in: function(style, text) { var T = this;
		ss = style.split('|'),
		out = text,
		style = ss.pop();
		while(style) {
			if(T.styles[style]) out = T.styles[style](out,function(cb,ctx) {
					T.queue.push(cb.bind(ctx));
				});
			else out = tag(style.endsWith(' div')||styles.div[style]?"div":"span",
				out,{class:style.replace(' div','')}
			);
			style = ss.pop();
		}
		return  out;
	},
	escape: function(style, text) { return  '`'+style+'['+text+']'; },
	parse: function(text) { var T = this,
		out = '';
		_.e(T.parsetext, function(e) {
			text = text.replace(e[0], e[1]);
		});
		try {
			console.log(text);
			return  eval('"'+text+'"');
		} catch(e) {
			return  null;
		}
	},
	js: function(text, testing) { var T = this;
		_.e(T.parsejs, function(rule) {
			text = text.replace.apply(text,rule);
		});
		return text;
	},
}),
Anim = C(function(){
	var T = this; 
	T.anims = {}; T.fresh = {}; T.none = {}; T.exec = {};
	T.ids = 0; T.kids = 0; 
	T.fs = 0;
	T.mo = false;
},{
  a: function(el,f,now) { var T = this; id=el.fid?el.fid:T.fs++;
    el.fid = id;
    return  function(set) {
      if(!set) return  el; else {
        var retry = setInterval(function(){
          if(!el.lock) {
            _.e(set,function(v,n) {
              if(typeof el[n] === "function") {
                el[n](v);
              } else {
                el[n] = v;        
              }
            });
            if(now) now.bind(el)();
            T.exec[el.fid] = f.bind(el);
            clearInterval(retry);
          }
        },1);
      }
    };
  },
	trans: function(a,set) {
    var T = this, el = a(), id = el.aid?el.aid:T.ids++;
    _.e(set,function(v,prop) { var
		  now = el[prop],
      from = parseFloat(now),
      to = parseFloat(v.to),
      dir = (to-from) > 0 ? 1:-1,
      suffix = (typeof now === "string") ? 
      	now.replace(from+'',''):0,
      check = from<v.to ? 
       function(value) { return  value>to; } : 
       function(value) { return  value<to; } ,
      modify = v.f?v.f:function(b){return  b};
	    if(el.anims) ++el.animc;
	    else { 
	    	el.animc=1;
	    	el.anims={};
	    }
	    el.anims[prop] = {
	      m: modify,
	      c: dir*(v.speed?v.speed:.33),
	      v: from,
	      s: suffix,
	      ch:check,
	      to:to,
        cb:v.then,
	    };
	    el.aid = id;
	    T.anims[el.aid] = a;
    });
  },
  change: function(a,dt) { var T = this, el = a(), e = {};
    _.e(el.anims, function(v,prop) {
      var d = v.c*dt;
      v.v += d;
      if(v.ch(v.v)) {
        e[prop] = v.m(v.to,true)+v.s;
        delete el.anims[prop]; --el.animc;
        if(v.cb) v.cb();
      } else {
        e[prop] = v.m(v.v)+v.s;
      }
    });
    a(e);
    return  (el.animc > 0);
  },
	start: function() { var T = this; 
		T.t = Date.now();
		T.going = true;
		T.loop();
	},
	stop: function() { var T = this; T.going = false; },
	loop: function() {
		var T = this, t = Date.now(), dt = t - T.t; T.t = t;
		_.e(T.none, function(f,id) { f(dt); delete T.none[id]; });
		_.e(T.anims, function(a,id) {
			if(!T.change(a,dt)) delete T.anims[id];
		});
		_.e(T.exec, function(f,id) {
			f(dt); delete T.exec[id];
		});
		if(T.going) requestAnimationFrame(T.loop.bind(T));
	},
});
(function() {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] 
                                   || window[vendors[x]+'CancelRequestAnimationFrame'];
    }
 
    if (!window.requestAnimationFrame)
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
              timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
 
    if (!window.cancelAnimationFrame)
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
}()); var sad,
allvars = _,C,eventypes,keycodes,El,tag,styles,Order,Editor,Anim,menu = new El("div", {
	into: "#root",
	addClass:"menu",
}),
presentation = new El("div",{
	into: "#root",
}),
//footer = new El("div",{
//	into: "#root",
//	addClass: "footer",
//	style: {borderTop:"1px solid #aaa"},
//}),
doc = new Editor("#root"),
//doc.load("gardens_and_skyscrapers");
focus = new El("#gardens_and_skyscrapers"),
content = focus.el.innerHTML;
presentation.html(doc.parse(content));
//doc.parse(content);
//footer.notes = 0;doc.load('gardens_and_skyscrapers');
</script></html>